# What's?
- 国際水準のクレジット取引のセキュリティ環境を整備するため、
経済産業省や業界団体、国際カードブランド、国内カード会社、大手通販事業者などが委員として参加する
「クレジット取引セキュリティ対策協議会」が、クレジットカード情報の非保持化の推進を盛り込んだ安全対策を
強化する方針「実行計画」を策定しました。（2016年に割賦販売法が改正され、「実行計画」は実務指針となり得るもの。）
「実行計画」では、クレジットカードを利用する加盟店に対し、2018年3月までに「クレジットカード情報の非保持化」または
「PCI DSS準拠」を完了することを要請しています。

## 「カード非保持化」
非保持の3要素：非処理・非保存・非通過
- 実行計画の指針では、カード情報を保持しない決済方法として、JavaScript型とリダイレクト型の2種類を紹介している。
    - JavaScript型:ECサイトにある入力画面でカード情報などを入力すると、JavaScriptを用いて、決済代行事業者のサーバにカード情報を送信する。送信された情報を基に決済し、その結果をトークン（乱数文字列）でECサイトに返す。これにより、ECサイトサーバにカード情報を保存せず決済する。
    - リダイレクト型:カード番号の入力画面が決済代行事業者側にある方式。ECサイトで購入する商品などを決め、決済代行事業者の画面に遷移してカード情報を入力して決済する。

## カードの決済方法
- <strong>仮売上処理</strong></br>
クレジットカードの利用限度枠の確保のみを行う決済処理。(オーソリ）
キャンセルなどのトラブルを避けるため、利用限度額の内の商品代金分を一定期間抑える処理であり、購入者に対しての代金請求はまだ発生していない。
- <strong>実売上処理</strong></br>
前述の仮売上処理で確保した商品代金分を、実際の売上として計上させる処理。加盟店側では売上が計上されていて、購入者に対して代金の請求がされている状態。
※ この実売上処理をしなかった場合、いつまで経っても仮売上で確保した代金は売上として計上できない
- <strong>仮実同時処理</strong></br>
仮売上と実売上の処理を同時に行う処理方法。(オーソリ）
レジットカードの利用限度額の中から商品代金分を抑え、抑えたものを実際の売上にする一連の処理を一回で行う。

## 実装参考
> https://www.paygent.co.jp/payment_service/token/
    
## 関連記事
> 徳丸浩のWebセキュリティ事件簿A
> クレジットカード情報を「非保持化」してもなぜ漏れてしまったのか
> https://tech.nikkeibp.co.jp/it/atclact/active/17/081800125/012500014/

> 徳丸浩のWebセキュリティ事件簿A
> 攻撃方法は「非保持化」前提に変わってきた！ 対策は基本に戻れ！
> https://tech.nikkeibp.co.jp/it/atclact/active/17/081800125/012500015/

> 徳丸浩のWebセキュリティ事件簿A
> dポイントの不正利用は安易な対応の組み合わせから生まれた
> https://tech.nikkeibp.co.jp/it/atclact/active/17/081800125/013100016/?i_cid=nbpnxta_reco
